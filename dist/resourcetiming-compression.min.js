!function(e){"use strict";var t,r;"undefined"!=typeof e&&(t=e,r=t.ResourceTimingCompression);var n={};n.noConflict=function(){return t.ResourceTimingCompression=r,n},n.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9};var i=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],o="\n",a=500,s="*",c="0",d="1",u="3",m=/^(https?:\/\/)([^\/]+)(.*)/;n.trimUrls=[],n.xssBreakWords=i,n.convertToTrie=function(e){var t,r,n,i,a,s,c,d,u={};for(t in e)if(e.hasOwnProperty(t)){for(r=t,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+o+"$2");if(e.hasOwnProperty(t))for(i=e[t],a=r.split(""),c=u,n=0;n<a.length;n++)s=a[n],d=c[s],"undefined"==typeof d?c=c[s]=n===a.length-1?i:{}:"string"==typeof d?c=c[s]={"|":d}:n===a.length-1?c[s]["|"]=i:c=c[s]}return u},n.optimizeTrie=function(e,t){var r,n,i,a=0,s=[];for(r in e)e.hasOwnProperty(r)&&s.push(r);for(var c=0;c<s.length;c++)r=s[c],"object"==typeof e[r]&&(n=this.optimizeTrie(e[r],!1),n&&(delete e[r],r===o?(r=n.name,a++):r+=n.name,e[r]=n.value)),a++;return 1===a?t?(i={},i[r]=e[r],i):{name:r,value:e[r]}:!!t&&e},n.trimTiming=function(e,t){"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0);var r=Math.round(e?e:0),n=Math.round(t?t:0);return 0===r?0:r-n},n.getNavStartTime=function(e){var t,r=0;if(!e)return r;try{t=e.location&&e.location.href,"performance"in e&&e.performance&&e.performance.timing&&e.performance.timing.navigationStart&&(r=e.performance.timing.navigationStart)}catch(e){}return r},n.findPerformanceEntriesForFrame=function(e,t,r,n){var i,o,a,s,c,d,u,m,f,p=[];if("undefined"==typeof t&&(t=!0),"undefined"==typeof r&&(r=0),"undefined"==typeof n&&(n=0),n>10)return p;try{if(a=this.getNavStartTime(e),e.frames)for(i=0;i<e.frames.length;i++)s=this.getNavStartTime(e.frames[i]),c=0,s>a&&(c=r+(s-a)),p=p.concat(this.findPerformanceEntriesForFrame(e.frames[i],!1,c,++n));try{if(m=e.location&&e.location.href,!("performance"in e&&e.performance&&e.performance.getEntriesByType))return p}catch(e){return p}t&&(o=e.performance.getEntriesByType("navigation"),o&&1===o.length?(d=o[0],p.push({name:e.location.href,startTime:0,initiatorType:"html",redirectStart:d.redirectStart,redirectEnd:d.redirectEnd,fetchStart:d.fetchStart,domainLookupStart:d.domainLookupStart,domainLookupEnd:d.domainLookupEnd,connectStart:d.connectStart,secureConnectionStart:d.secureConnectionStart,connectEnd:d.connectEnd,requestStart:d.requestStart,responseStart:d.responseStart,responseEnd:d.responseEnd,serverTiming:d.serverTiming||[]})):e.performance.timing&&(u=e.performance.timing,0!==u.navigationStart&&u.responseEnd<=u.navigationStart+36e5&&p.push({name:e.location.href,startTime:0,initiatorType:"html",redirectStart:u.redirectStart?u.redirectStart-u.navigationStart:0,redirectEnd:u.redirectEnd?u.redirectEnd-u.navigationStart:0,fetchStart:u.fetchStart?u.fetchStart-u.navigationStart:0,domainLookupStart:u.domainLookupStart?u.domainLookupStart-u.navigationStart:0,domainLookupEnd:u.domainLookupEnd?u.domainLookupEnd-u.navigationStart:0,connectStart:u.connectStart?u.connectStart-u.navigationStart:0,secureConnectionStart:u.secureConnectionStart?u.secureConnectionStart-u.navigationStart:0,connectEnd:u.connectEnd?u.connectEnd-u.navigationStart:0,requestStart:u.requestStart?u.requestStart-u.navigationStart:0,responseStart:u.responseStart?u.responseStart-u.navigationStart:0,responseEnd:u.responseEnd?u.responseEnd-u.navigationStart:0})));var g=e.performance.getEntriesByType("resource"),S=[];for(i=0;g&&i<g.length;i++)u=g[i],f={name:u.name,initiatorType:u.initiatorType,startTime:u.startTime+r,redirectStart:u.redirectStart?u.redirectStart+r:0,redirectEnd:u.redirectEnd?u.redirectEnd+r:0,fetchStart:u.fetchStart?u.fetchStart+r:0,domainLookupStart:u.domainLookupStart?u.domainLookupStart+r:0,domainLookupEnd:u.domainLookupEnd?u.domainLookupEnd+r:0,connectStart:u.connectStart?u.connectStart+r:0,secureConnectionStart:u.secureConnectionStart?u.secureConnectionStart+r:0,connectEnd:u.connectEnd?u.connectEnd+r:0,requestStart:u.requestStart?u.requestStart+r:0,responseStart:u.responseStart?u.responseStart+r:0,responseEnd:u.responseEnd?u.responseEnd+r:0},(u.encodedBodySize||u.decodedBodySize||u.transferSize)&&(f.encodedBodySize=u.encodedBodySize,f.decodedBodySize=u.decodedBodySize,f.transferSize=u.transferSize),u.serverTiming&&u.serverTiming.length&&(f.serverTiming=u.serverTiming),S.push(f);p=p.concat(S)}catch(e){return p}return p},n.toBase36=function(e){return"number"==typeof e&&0!==e?e.toString(36):"string"==typeof e?e:""},n.getVisibleEntries=function(e){var t,r,n=["img","iframe","image"],i={},o=e.document,a=o.createElement("A");return t=void 0!==e.pageXOffset?e.pageXOffset:(o.documentElement||o.body.parentNode||o.body).scrollLeft,r=void 0!==e.pageYOffset?e.pageYOffset:(o.documentElement||o.body.parentNode||o.body).scrollTop,n.forEach(function(e){var n,s,c,d,u=o.getElementsByTagName(e);for(s=0;s<u.length;s++)n=u[s],n&&(d=n.src||n.getAttribute("src")||n.getAttribute("xlink:href"),a.href=d,d=a.href,d&&!i[d]&&(c=n.getBoundingClientRect(),(c.height||n.offsetHeight)&&(c.width||n.offsetWidth)&&(i[d]=[c.height||n.offsetHeight,c.width||n.offsetWidth,Math.round(c.top+r),Math.round(c.left+t)])))}),i},n.inArray=function(e,t){var r;if("undefined"==typeof e||"undefined"==typeof t||!t.length)return!1;for(r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},n.getFilteredResourceTiming=function(e,t,r,i){var o,a,s=this.findPerformanceEntriesForFrame(e,!0,0,0),c=this.getNavStartTime(e),d={};if(!s||!s.length)return{entries:[]};var u=[];for(o=0;o<s.length;o++)if(a=s[o],0!==a.name.indexOf("about:")&&0!==a.name.indexOf("javascript:")&&!(t&&c+a.startTime<t)){if(r&&c+a.startTime>r)break;("undefined"==typeof i||"*"===i||!i.length||a.initiatorType&&this.inArray(a.initiatorType,i))&&(n.accumulateServerTimingEntries(d,a.serverTiming),u.push(a))}var m=n.compressServerTiming(d);return{entries:u,serverTiming:{lookup:m,indexed:n.indexServerTiming(m)}}},n.compressSize=function(e){var t,r,n,i;return e.encodedBodySize||e.decodedBodySize||e.transferSize?(t=e.transferSize,r=e.encodedBodySize,n=e.decodedBodySize,i=[r,t?t-r:"_",n-r],i.map(this.toBase36).join(",").replace(/,+$/,"")):""},n.cleanupURL=function(e,t){var r;return e&&"[object Array]"!==Object.prototype.toString.call(e)?("undefined"!=typeof t&&e&&e.length>t&&(r=e.indexOf("?"),e=r!==-1&&r<t?e.substr(0,r)+"?...":e.substr(0,t-3)+"..."),e):""},n.trimUrl=function(e,t){var r,n,i;if(e&&t)for(r=0;r<t.length;r++)if(i=t[r],"string"==typeof i){if(n=e.indexOf(i),n!==-1){e=e.substr(0,n+i.length)+"...";break}}else i instanceof RegExp&&i.test(e)&&(e=e.replace(i,"$1")+"...");return this.cleanupURL(e,a)},n.getResourceTiming=function(t,r,i){"undefined"==typeof t&&(t=e);var o=n.getFilteredResourceTiming(t,r,i),a=o.entries,s=o.serverTiming;return a&&a.length?n.compressResourceTiming(t,a,s):{}},n.compressResourceTiming=function(e,t,r){var i,o,a,m,f,p={},g={};for(g=this.getVisibleEntries(e),i=0;i<t.length;i++){o=t[i],a=this.INITIATOR_TYPES[o.initiatorType],"undefined"==typeof a&&(a=0),f=a+[this.trimTiming(o.startTime,0),this.trimTiming(o.responseEnd,o.startTime),this.trimTiming(o.responseStart,o.startTime),this.trimTiming(o.requestStart,o.startTime),this.trimTiming(o.connectEnd,o.startTime),this.trimTiming(o.secureConnectionStart,o.startTime),this.trimTiming(o.connectStart,o.startTime),this.trimTiming(o.domainLookupEnd,o.startTime),this.trimTiming(o.domainLookupStart,o.startTime),this.trimTiming(o.redirectEnd,o.startTime),this.trimTiming(o.redirectStart,o.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var S=this.compressSize(o);""!==S&&(f+=s+d+S),o.serverTiming&&o.serverTiming.length&&(f+=s+u+o.serverTiming.reduce(function(e,t,i){var o=String(t.duration);"0."===o.substring(0,2)&&(o=o.substring(1));var a=n.identifyServerTimingEntry(r.indexed[t.name].index,r.indexed[t.name].descriptions[t.description]);return e+=(i>0?",":"")+o+a},"")),m=this.trimUrl(o.name,this.trimUrls),m=this.reverseHostname(m),void 0!==p[m]?p[m]+="|"+f:void 0!==g[m]?p[m]=s+c+g[m].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+f:p[m]=f}return{restiming:this.optimizeTrie(this.convertToTrie(p),!0),servertiming:r.lookup}},n.reverseHostname=function(e){return e.replace(m,function(e,t,r,i){return t+n.reverseString(r)+i})},n.reverseString=function(e){for(var t=e.length,r="";t--;)r+=e[t];return r},n.accumulateServerTimingEntries=function(e,t){(t||[]).forEach(function(t){"undefined"==typeof e[t.name]&&(e[t.name]={count:0,counts:{}});var r=e[t.name];r.counts[t.description]=r.counts[t.description]||0,r.counts[t.description]++,r.count++})},n.compressServerTiming=function(e){return Object.keys(e).sort(function(t,r){return e[r].count-e[t].count}).reduce(function(t,r){var n=Object.keys(e[r].counts).sort(function(t,n){return e[r].counts[n]-e[r].counts[t]});return t.push(1===n.length&&""===n[0]?r:[r].concat(n)),t},[])},n.indexServerTiming=function(e){return e.reduce(function(e,t,r){var n,i;return Array.isArray(t)?(n=t[0],i=t.slice(1).reduce(function(e,t,r){return e[t]=r,e},{})):(n=t,i={"":0}),e[n]={index:r,descriptions:i},e},{})},n.identifyServerTimingEntry=function(e,t){var r="";return e&&(r+=e),t&&(r+="."+t),r.length&&(r=":"+r),r},"function"==typeof define&&define.amd?define([],function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:"undefined"!=typeof t&&(t.ResourceTimingCompression=n)}("undefined"!=typeof window?window:void 0);